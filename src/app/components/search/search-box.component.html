<div class="relative" #searchContainer>
  <!-- Search Input -->
  <div class="relative flex items-center">
    <!-- Search Icon -->
    <svg 
      class="absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-cyber-text-secondary pointer-events-none"
      fill="none" 
      stroke="currentColor" 
      viewBox="0 0 24 24"
    >
      <path 
        strokeLinecap="round" 
        strokeLinejoin="round" 
        strokeWidth="2" 
        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
      />
    </svg>

    <input
      type="search"
      [(ngModel)]="searchQuery"
      (input)="onSearch()"
      (keydown)="onKeyDown($event)"
      [placeholder]="'ابحث عن المنتجات...'"
      class="w-full pl-10 pr-12 py-2 rounded-lg border border-cyber-border 
             bg-cyber-card text-cyber-text-primary 
             focus:outline-none focus:ring-2 focus:ring-cyber-accent-primary"
    >

    <!-- Clear Button -->
    <button
      *ngIf="searchQuery"
      (click)="clearSearch()"
      class="absolute left-3 top-1/2 transform -translate-y-1/2 p-1 
             text-cyber-text-secondary hover:text-cyber-text-primary 
             transition-colors focus:outline-none"
      aria-label="Clear search"
    >
      <svg 
        class="w-4 h-4" 
        fill="none" 
        stroke="currentColor" 
        viewBox="0 0 24 24"
      >
        <path 
          strokeLinecap="round" 
          strokeLinejoin="round" 
          strokeWidth="2" 
          d="M6 18L18 6M6 6l12 12"
        />
      </svg>
    </button>
  </div>

  <!-- Results Dropdown -->
  <div *ngIf="showResults" 
       class="absolute z-50 w-full mt-1 bg-cyber-card 
              rounded-lg shadow-card border border-cyber-border 
              max-h-96 overflow-y-auto">
    <!-- Loading State -->
    <div *ngIf="loading" class="p-4">
      <div class="animate-pulse space-y-3">
        <div *ngFor="let i of [1,2,3]">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-cyber-surface rounded"></div>
            <div class="flex-1">
              <div class="h-4 bg-cyber-surface rounded w-3/4 mb-2"></div>
              <div class="h-3 bg-cyber-surface rounded w-1/4"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Results List -->
    <ng-container *ngIf="!loading">
      <div *ngIf="results.length > 0; else noResults">
        <a *ngFor="let product of results; let i = index"
           [routerLink]="['/product', product.id]"
           class="flex items-center gap-3 p-3 hover:bg-cyber-surface 
                  transition-colors cursor-pointer"
           [class.bg-cyber-accent-primary bg-opacity-10]="i === selectedIndex"
           (mouseenter)="selectedIndex = i">
          
          <img [src]="product.image" 
               [alt]="product.name"
               class="w-12 h-12 object-contain rounded">
          
          <div class="flex-1">
            <div class="font-medium text-cyber-text-primary" 
                 [innerHTML]="highlightMatch(product.name)">
            </div>
            <div class="text-sm text-cyber-text-secondary">
              {{product.prices[0]?.amount}} {{product.prices[0]?.currency}}
            </div>
          </div>
        </a>
      </div>

      <!-- No Results Template -->
      <ng-template #noResults>
        <div class="p-4 text-center text-cyber-text-secondary">
          لم يتم العثور على نتائج
        </div>
      </ng-template>
    </ng-container>
  </div>
</div>